![배너.png](/ReadMeSource/배너.png)

- 태그: 3인칭, 멀티플레이어
- 사용 프로그램: Unreal Engine 5, VisualStudio 2022, Github, Notion
- 팀 구성: 프로그래머 1인 개발
- 플랫폼: PC
- 작업 기간: 2024년 4월 → 2024년 8월 초
<br>


## ❗개요 및 주의사항
- **Unreal Engine 5를 사용한 PC(Windows) 기반 3인칭 멀티플레이 슈팅 게임.**
- 총을 쏘는 것이 아닌, 폭탄을 던져서 적을 제거하고 점수를 얻어 승리하는 게임입니다.
- Unreal Engine 5의 기본 프레임워크와 멀티플레이 메커니즘 경험을 목표로 삼았으며, 대부분의 기능은 C++을 이용해 제작했습니다.
- [해당 구글 드라이브](https://drive.google.com/file/d/1bilkgVFJ_O5HckQhz9qo_-21fHhYLn7b/view?usp=drive_link)(447MB)에서 게임 실행 파일을 다운로드하실 수 있습니다. 유료 에셋(POLYGON_AncientEmpire)을 사용하였기에 Github에는 소스코드 관련 파일들만 업로드되었습니다.
- 본 게임은 언리얼의 온라인 서브시스템을 사용합니다. 스팀 클라이언트에 로그인한 후 게임 파일을 실행하시면 다른 컴퓨터의 스팀 유저와 함께 플레이하실 수 있습니다. 혼자는 안됩니다!
- 조작법
    - W, S, A, D - 전후좌우 이동
    - 마우스 움직임 - 캐릭터 시야 움직임
    - 마우스 왼쪽 / 오른쪽 클릭 길게 누르기 - 폭탄 던지기 / 조준
    - Tab - 점수판
    - Esc - 게임 메뉴
<br>


## 🖥️ 개발 내용
### 게임 흐름
- 게임은 메인화면-로비-본 게임-메인화면으로 순환하는 사이클을 가집니다.
- 메인화면
    - 새로운 세션을 생성하거나 다른 유저가 생성한 세션을 탐색하여 참가합니다. 이때 세션에 참가할 수 있는 최대 인원 및 LAN 사용 여부를 선택할 수 있습니다.
- 로비
    - 세션을 생성하거나 세션에 참가한 유저는 로비로 이동하며, 인원에 맞추어 참가한 유저의 이름이 표시된 석상이 나타납니다.
    - 로비에서는 게임 준비 / 메인화면으로 나가기를 선택할 수 있습니다. 클라이언트의 준비 신호는 서버로 전송되며, 모든 인원이 준비되었을 때 본 게임으로 서버 트래블을 진행합니다.
    - 총 인원 대비 준비된 인원수가 동기화되어 로비 상단 UI에 표시됩니다.
- 본 게임
    - 참가한 인원 모두가 서버트래블 및 로딩을 마칠 때까지 대기 후 매치가 시작됩니다.
    - 각 유저는 일정 시간 후 폭발하는 폭탄을 던져 데미지를 입힐 수 있습니다. 감소된 체력은 맵 곳곳에 존재하는 아이템을 사용하여 회복할 수 있으며, 모든 체력을 소진하여 사망한 플레이어는 지정 스폰 포인트 중 한곳에 랜덤하게 리스폰 됩니다.
- 지정된 매치 시간이 만료되거나 지정 점수를 달성한 유저가 나타났을 때, 매치를 종료하고 점수판을 표시합니다.
<br>


### 폭탄 시스템
![폭탄 매니저.png](/ReadMeSource/bomb_manager_bg.png)
- 폭탄은 캐릭터가 손에 들고 있는 폭탄과 오브젝트 풀에 저장된 폭탄으로 구분됩니다.
    - 손에 들고 있는 폭탄은 캐릭터의 소켓에 고정되어 있습니다. 던지는 시점에 모습을 숨기고, 재장전 시점에 모습을 다시 드러냅니다.
    - 오브젝트 풀에 있는 폭탄들은 서버의 폭탄 매니저에 의해 관리됩니다. 폭탄 매니저는 주어진 종류의 폭탄을 생성하고 관리하며, 캐릭터의 요청에 따라 비활성화 상태인 폭탄을 활성화하여 전달합니다. 폭탄의 폭발 트리거를 발동하는 역할 또한 맡습니다.
- 폭탄은 활성화 / 비활성화 상태 변경이 가능합니다.
    - 함수 호출에 따라 가시성과 틱, 물리 연산에 관한 활성화 여부가 변경됩니다.
    - 폭탄 매니저에 의해 트리거가 활성화되면 지정 시간 이후 폭발합니다. 이때 범위 내의 대상에게 피해를 입히고 이펙트를 재생합니다. 폭발 이후에는 비활성화 상태로 변경됩니다.
    - 활성화 여부에 관련 없이 폭탄의 위치와 정보가 리플리케이트됩니다.
- 클라이언트 플레이어가 폭탄 던지기 입력 시 서버 RPC를 통해 해당 신호가 서버에 전달됩니다. 서버는 프로퍼티 리플리케이션을 통해 모든 클라이언트에게 해당 정보를 전달합니다. 조준 여부 또한 동일한 과정을 거쳐서 전달됩니다.
- 던지기 또는 조준 신호를 전달받으면 서버와 클라이언트를 구분하여 동작을 진행합니다.
    - 클라이언트 - 몽타주 재생 / UI표시 / 폭발 이펙트 재생
    - 서버 - 폭탄 차징 / 폭탄 던지기 / 폭발 데미지 처리
- 폭탄이 던져지는 타이밍은 AnimNotify를 활용합니다.
    - 플레이어의 입력은 몽타주를 재생하고, 몽타주의 특정 시점에 AnimNofity가 작동하여 관련된 대리자를 호출합니다.
- 조준하는 동안 차징 UI 표시와 타임라인을 활용한 카메라 확대 및 축소가 진행됩니다.
<br>


### 데미지 & 사망 시스템
![스탯컴포넌트 배경있음.png](/ReadMeSource/stat_component_bg.png)

- 각 플레이어 캐릭터는 스탯 컴포넌트를 보유합니다.
    - 스탯 컴포넌트는 체력 변경, 사망 처리, 사망 시 가해자와 피해자 정보 등을 전달하는 대리자를 소유하며 현재 체력의 변경과 계산을 담당합니다.
    - 본 게임에서 사용되는 스텟은 FEPCharacterStat 구조체에 정리되어 있습니다. 구조체 내부에는 HP가 존재합니다.
    - 캐릭터의 기본 스텟은 FEPCharacterStat 구조체를 열로 사용하는 UDataTable에 저장되어 있습니다. 게임 인스턴스에서 이를 로드하고, 로드된 데이터를 스탯 컴포넌트가 사용합니다.

![데미지 구조 배경 있음.png](/ReadMeSource/damage_structure_bg.png)

- 데미지 적용
    - 폭탄은 서버에서 ApplyRadialDamage() 함수를 통해 범위 내의 캐릭터들에게 데미지를 전달합니다. 피해를 입은 캐릭터들의 TakeDamage() 함수가 호출되며, 스탯 컴포넌트의 체력 변경 함수가 실행됩니다.
    - 변경된 체력은 프로퍼티 리플리케이션을 통해 각 클라이언트들에게 전달되며, 프로퍼티 값의 변경이 확인되었을 때 OnRep 함수에서 대리자를 호출하여 관련 기능들을 실행합니다.
- 아이템
    - 맵 곳곳에는 아이템이 존재하며, 아이템 타입과 스탯 증감 정보를 가지고 있습니다.
    - 플레이어와 오버랩되면 아이템이 사용되며 플레이어의 체력을 일정량 회복합니다.
- 데미지를 입은 플레이어는 짧은 시간 동안 카메라가 흔들립니다.
<br>


### UI 정보 동기화
![타이머UI 시작 전.png](/ReadMeSource/TimerUI_ready.png)
(아직 준비되지 않은 플레이어가 있기 때문에 타이머가 작동하지 않는다.)
![타이머UI 시작 후.png](/ReadMeSource/TimerUI_start.png)
(모든 플레이어가 준비되었을 때, 서버와 클라이언트에서 동시에 타이머가 작동한다.)

- 메인 메뉴와 로비에는 세션의 생성과 파괴, 탐색과 참가에 사용되는 UI가 있습니다.
- 본 게임 도중 Esc 키를 눌러 게임 메뉴 UI를 표시할 수 있습니다. 게임 메뉴에서는 본 게임 혹은 메인 메뉴로 돌아갈 수 있습니다.
- 본 게임 도중 Tab 버튼을 누르거나 매치가 종료되었을 때 점수판 UI를 확인할 수 있습니다.
    - 점수판에는 유저의 이름, 킬 카운트, 데스 카운트, 점수가 표시됩니다.
    - 게임 스테이트에는 점수 관리를 위한 FScoreBoard 구조체 배열이 존재합니다. FScoreBoard는 PlayerState와 점수를 멤버로 가지며, PlayerState는 유저의 이름과 킬, 데스 정보를 가집니다. 점수만 별도로 존재하는 이유는 점수가 높은 순서대로 점수판을 유지하기 위해서입니다.
    - 게임 스테이트의 FScoreBoard 배열과 각 PlayerState의 정보는 리플리케이트 되어 모든 클라이언트에서 동기화됩니다. 킬, 데스, 점수 셋 중 하나라도 변동이 있다면 점수판을 갱신합니다.
- 본 게임의 상단에는 잔여 매치 시간을 나타내는 타이머 UI가 표시됩니다.
    - 해당 UI는 모든 플레이어의 서버 트래블과 로딩이 완료된 이후 매치가 시작될 때 활성화됩니다.
    - 플레이어 컨트롤러에서 전송 지연시간을, 게임 스테이트에서 매치 진행 시간을 구해 서버-클라이언트 타이머 동기화를 진행합니다.
<br>


### 캐릭터 컨트롤

- 키보드와 마우스 입력을 사용하여 플레이어 캐릭터를 조종할 수 있습니다.
- 에임 오프셋을 적용하여 마우스 움직임에 따라 시선이 이동합니다.
- 애니메이션 몽타주를 사용하여 던지기, 재장전 동작이 실행됩니다.
<br>


## 🕹️ 인게임 영상
[![포트폴리오 영상](/ReadMeSource/youtube_thumbnail_2.png)](https://youtu.be/0zBQWa4tcEE?si=OKgr1P8ftiUFI7M)
